#  Licensed to Elasticsearch B.V. under one or more contributor
#  license agreements. See the NOTICE file distributed with
#  this work for additional information regarding copyright
#  ownership. Elasticsearch B.V. licenses this file to you under
#  the Apache License, Version 2.0 (the "License"); you may
#  not use this file except in compliance with the License.
#  You may obtain a copy of the License at
#
# 	http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing,
#  software distributed under the License is distributed on an
#  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
#  KIND, either express or implied.  See the License for the
#  specific language governing permissions and limitations
#  under the License.
import tempfile

import numpy as np
import pytest

try:
    import sklearn  # noqa: F401

    HAS_SKLEARN = True
except ImportError:
    HAS_SKLEARN = False

try:
    import transformers  # noqa: F401

    from eland.ml.pytorch import PyTorchModel
    from eland.ml.pytorch.transformers import TransformerModel

    HAS_TRANSFORMERS = True
except ImportError:
    HAS_TRANSFORMERS = False

from tests import ES_TEST_CLIENT, ES_VERSION

pytestmark = [
    pytest.mark.skipif(
        ES_VERSION < (8, 0, 0),
        reason="This test requires at least Elasticsearch version 8.0.0",
    ),
    pytest.mark.skipif(
        not HAS_SKLEARN, reason="This test requires 'scikit-learn' package to run"
    ),
    pytest.mark.skipif(
        not HAS_TRANSFORMERS, reason="This test requires 'transformers' package to run"
    ),
]

TEXT_PREDICTION_MODELS = [
    # (
    #    "distilbert-base-uncased",
    #    "fill_mask",
    #    "[MASK] is the capital of France.",
    #    "paris",
    # ),
    ("bert-base-cased", "fill_mask", "[MASK] is the capital of France.", "Paris"),
    # (
    #    "distilbert-base-uncased-finetuned-sst-2-english",
    #    "text_classification",
    #    "I love Elasticsearch",
    #    "POSITIVE",
    # ),
    # (
    #    "nateraw/bert-base-uncased-emotion",
    #    "text_classification",
    #    "Eland and pytorch are amazing.",
    #    "joy",
    # ),
    # (
    #    "elastic/distilbert-base-cased-finetuned-conll03-english",
    #    "ner",
    #    "I am Bart Simpson and I work at Elastic.",
    #    "I am [Bart Simpson](PER&Bart+Simpson) and I work at [Elastic](ORG&Elastic).",
    # ),
    # (
    #    "elastic/distilbert-base-uncased-finetuned-conll03-english",
    #    "ner",
    #    "I am Bart Simpson and I work at Elastic.",
    #    "I am [Bart Simpson](PER&Bart+Simpson) and I work at [Elastic](ORG&Elastic).",
    # ),
]

ZERO_SHOT_MODELS = [
    (
        "typeform/squeezebert-mnli",
        "Elasticsearch now supports PyTorch machine learning models for NLP.",
        ["technology", "politics", "sports"],
        "technology",
    ),
    (
        "typeform/distilbert-base-uncased-mnli",
        "Elasticsearch is the distributed, RESTful search and analytics engine at the heart of the Elastic Stack. You "
        "can use Elasticsearch to store, search, and manage data.",
        ["sports", "technology", "politics", "popular"],
        "technology",
    ),
]

TEXT_EMBEDDING = [
    (
        False,
        "sentence-transformers/all-MiniLM-L12-v2",
        "Elasticsearch is the distributed, RESTful search and analytics engine at the heart of the Elastic Stack. You "
        "can use Elasticsearch to store, search, and manage data.",
        [
            0.0037712352350354195,
            -0.030481912195682526,
            -0.03365401178598404,
            -0.0001335958222625777,
            -0.00690954364836216,
            -0.02836783602833748,
            -0.05146409943699837,
            0.05952649191021919,
            0.020197756588459015,
            0.03895943611860275,
            0.004077147226780653,
            0.026496144011616707,
            -0.02277253568172455,
            0.005767420865595341,
            -0.018845925107598305,
            0.034084320068359375,
            0.004399542696774006,
            0.0316573865711689,
            0.004155017901211977,
            -0.09351115673780441,
            0.06918929517269135,
            0.039492979645729065,
            0.009238188154995441,
            -0.07573536038398743,
            -0.01426721177995205,
            -0.009398194029927254,
            -0.036571163684129715,
            0.01612229086458683,
            -0.042382143437862396,
            -0.0068984548561275005,
            0.09683021157979965,
            -0.0187432412058115,
            0.11261739581823349,
            0.04001711308956146,
            -0.02951154112815857,
            0.030622316524386406,
            -0.012094789184629917,
            -0.01963229663670063,
            -0.04858902096748352,
            -0.01174047589302063,
            0.02892044372856617,
            -0.017641479149460793,
            -0.0437215194106102,
            0.02210555039346218,
            -0.0015220753848552704,
            0.020085811614990234,
            -0.004508133977651596,
            0.012043925933539867,
            -0.01804201304912567,
            -0.040649257600307465,
            -0.040280021727085114,
            0.020468570291996002,
            0.016827916726469994,
            -0.0507950522005558,
            0.010143174789845943,
            0.08644240349531174,
            0.07957837730646133,
            -0.05301407724618912,
            -0.024896997958421707,
            -0.05797343701124191,
            0.11501969397068024,
            0.029073162004351616,
            0.0051078530959784985,
            0.009118665009737015,
            -0.0912148728966713,
            0.014023243449628353,
            -0.029612815007567406,
            0.04628580063581467,
            0.07040295004844666,
            -0.07557704299688339,
            0.06818722188472748,
            -0.014259464107453823,
            -0.04523153230547905,
            0.07238060235977173,
            -0.009485247544944286,
            0.008597194217145443,
            0.09068455547094345,
            -0.05969524756073952,
            0.07476720958948135,
            0.030170630663633347,
            -0.057958755642175674,
            -0.03830433636903763,
            -0.016067931428551674,
            -0.04489272087812424,
            -0.012557834386825562,
            -0.08076123893260956,
            -0.03559476137161255,
            -0.054170262068510056,
            0.05495510995388031,
            0.03465660288929939,
            0.0637698844075203,
            -0.003932842519134283,
            0.04610856994986534,
            -0.10064198076725006,
            -0.006727264728397131,
            0.016383139416575432,
            -0.05118856951594353,
            -0.008541851304471493,
            0.1048741415143013,
            -0.033692244440317154,
            -0.015009834431111813,
            0.054833605885505676,
            -0.030323438346385956,
            -0.01922871731221676,
            -0.004449940752238035,
            0.0009935521520674229,
            -0.053164709359407425,
            0.013289177790284157,
            0.00800948403775692,
            0.025207241997122765,
            0.03203672543168068,
            0.0159728042781353,
            -0.0019451469415798783,
            -0.025858378037810326,
            0.003811911214143038,
            -0.0007070595165714622,
            -0.06838871538639069,
            -0.02424040250480175,
            -0.03514431044459343,
            0.10322929918766022,
            -0.059738293290138245,
            -0.016767270863056183,
            0.04758531600236893,
            0.0053009409457445145,
            0.01585463434457779,
            0.06050555035471916,
            -0.02351142279803753,
            0.028913114219903946,
            0.0409059152007103,
            -0.037876591086387634,
            -0.02660094015300274,
            -0.07878168672323227,
            -0.10875652730464935,
            0.041324812918901443,
            -0.03852027654647827,
            0.06697846949100494,
            -0.07236555963754654,
            -0.060778431594371796,
            -0.023312076926231384,
            0.13566181063652039,
            0.05942463129758835,
            0.042442016303539276,
            0.011608626693487167,
            0.013611102476716042,
            0.0467606820166111,
            0.010652383789420128,
            0.009909585118293762,
            -0.1229449212551117,
            -0.0774649977684021,
            -0.08852176368236542,
            -0.02603425830602646,
            0.015660369768738747,
            0.014925223775207996,
            -0.006933133117854595,
            0.09392380714416504,
            -0.11864395439624786,
            0.029810357838869095,
            0.008116704411804676,
            0.012341981753706932,
            -0.057908281683921814,
            0.024246595799922943,
            0.005292652174830437,
            -0.04638510197401047,
            0.03164558485150337,
            -0.01783127151429653,
            0.023113351315259933,
            -0.021473081782460213,
            -0.04495728015899658,
            -0.0489838570356369,
            0.021811185404658318,
            0.07806515693664551,
            0.002124704187735915,
            -0.05481017008423805,
            -0.04687852784991264,
            -0.02297184243798256,
            0.021443545818328857,
            0.03264031559228897,
            0.0003128442622255534,
            0.04523957893252373,
            -0.1271415501832962,
            0.0671202689409256,
            -0.07674111425876617,
            0.039126113057136536,
            0.12357396632432938,
            0.00819889921694994,
            0.028351806104183197,
            -0.008366379886865616,
            0.03786984086036682,
            -0.03940378129482269,
            0.004199545830488205,
            0.08905965089797974,
            0.02636674791574478,
            0.13493403792381287,
            0.060356754809617996,
            0.04773511365056038,
            0.008691680617630482,
            -0.036999255418777466,
            0.004985872656106949,
            0.03408161550760269,
            0.018793860450387,
            -0.01333162933588028,
            0.08478252589702606,
            -0.01684817485511303,
            0.09032021462917328,
            -0.0340888537466526,
            0.04709931090474129,
            -0.008690912276506424,
            -0.0495891347527504,
            -0.05930714309215546,
            0.01009418535977602,
            0.049603551626205444,
            0.08210539072751999,
            0.02808409370481968,
            0.034355293959379196,
            -0.018834136426448822,
            -0.09677813947200775,
            -0.03237484395503998,
            -0.03555070608854294,
            -0.06383436918258667,
            0.03483237326145172,
            0.01714547537267208,
            0.0035199634730815887,
            -0.06165474280714989,
            7.85944926914588e-33,
            0.028866415843367577,
            -0.04647941514849663,
            -0.05888395383954048,
            0.07047773897647858,
            0.055506832897663116,
            0.0028398940339684486,
            0.040329258888959885,
            -0.06423458456993103,
            -0.011908282525837421,
            0.05020765960216522,
            -0.04150787740945816,
            -0.030940746888518333,
            0.11088748276233673,
            -0.04858129099011421,
            -0.10024851560592651,
            0.028600899502635002,
            -0.0047572338953614235,
            -0.09413924813270569,
            0.021019449457526207,
            0.005526501685380936,
            0.010176003910601139,
            -0.026425836607813835,
            0.01222997810691595,
            0.022507471963763237,
            -0.0018880009884014726,
            -0.0022913094144314528,
            0.05878821387887001,
            -0.08903750777244568,
            -0.0864739865064621,
            -0.03905723989009857,
            -0.046932462602853775,
            -0.05436200648546219,
            0.020368197932839394,
            -0.026840437203645706,
            0.025138165801763535,
            -0.016524475067853928,
            0.036324936896562576,
            -0.0899248942732811,
            -0.023870108649134636,
            -0.02322075329720974,
            0.03881451115012169,
            0.06106534227728844,
            0.04234654828906059,
            -0.022839650511741638,
            0.05618314445018768,
            0.046128541231155396,
            -0.05084122344851494,
            0.08304987102746964,
            -0.033476121723651886,
            -0.015991127118468285,
            -0.07135190069675446,
            0.09570572525262833,
            -0.06097591295838356,
            -0.011919123120605946,
            0.010229592211544514,
            0.05714195594191551,
            -0.0894802063703537,
            0.06984465569257736,
            -0.11130580306053162,
            0.08219874650239944,
            -0.025544853881001472,
            0.0000017220658037331305,
            -0.03961511328816414,
            0.11663887649774551,
            0.00991143099963665,
            0.02549632638692856,
            0.02792959101498127,
            -0.0560375452041626,
            -0.1255187839269638,
            0.036713678389787674,
            0.05951154977083206,
            -0.07247511297464371,
            0.052210014313459396,
            -0.016808222979307175,
            0.002298749517649412,
            0.012870670296251774,
            0.028170030564069748,
            0.03624413534998894,
            0.00646212650462985,
            0.011977734975516796,
            0.03474821895360947,
            0.05897247791290283,
            -0.019231434911489487,
            -0.00565249053761363,
            -0.0016013863496482372,
            0.032272014766931534,
            -0.009905013255774975,
            0.07812612503767014,
            0.0063345469534397125,
            0.007176761049777269,
            -0.024810222908854485,
            -0.13774797320365906,
            -0.15348905324935913,
            -0.06804517656564713,
            0.0785336121916771,
            2.1150058597282992e-32,
            -0.013892804272472858,
            0.05591318756341934,
            0.050703782588243484,
            -0.016834644600749016,
            0.027637803927063942,
            -0.033562108874320984,
            0.05419256538152695,
            0.11449886858463287,
            0.029707586392760277,
            -0.022709520533680916,
            0.07389979809522629,
            -0.07357893884181976,
            -0.10579443722963333,
            -0.007560309953987598,
            0.004672566428780556,
            0.010546407662332058,
            -0.03701718524098396,
            0.02584259770810604,
            -0.020555920898914337,
            -0.029343249276280403,
            -0.008900263346731663,
            -0.006442338693886995,
            0.07320588082075119,
            -0.001093558152206242,
            0.060992028564214706,
            -0.008974148891866207,
            0.004197342786937952,
            -0.009920436888933182,
            -0.025736892595887184,
            -0.0724557638168335,
            -0.0020025083795189857,
            0.07366622239351273,
            0.040275849401950836,
            0.03316127508878708,
            -0.000025899140382534824,
            0.07468714565038681,
            0.03121902421116829,
            -0.009058235213160515,
            -0.03177209943532944,
            0.07971727848052979,
            0.040641337633132935,
            0.11953351646661758,
            -0.03250516951084137,
            -0.022773459553718567,
            -0.06430361419916153,
            0.06316282600164413,
            0.035190682858228683,
            -0.04853269085288048,
            0.0500844307243824,
            -0.04704730212688446,
            -0.02760794386267662,
            -0.049474384635686874,
            0.037018924951553345,
            0.008347260765731335,
            0.004771129228174686,
            0.00255514495074749,
            -0.000719240284524858,
            -0.10453514009714127,
            0.0712762326002121,
            0.002318795770406723,
            0.04635736718773842,
            -0.07783054560422897,
            0.035038504749536514,
            -0.05477318540215492,
        ],
    ),
    (
        True,
        "sentence-transformers/all-MiniLM-L12-v2",
        "Elasticsearch is the distributed, RESTful search and analytics engine at the heart of the Elastic Stack."
        " You can use Elasticsearch to store, search, and manage data.",
        [
            0.0037712352350354195,
            -0.030481912195682526,
            -0.03365401178598404,
            -0.0001335958222625777,
            -0.00690954364836216,
            -0.02836783602833748,
            -0.05146409943699837,
            0.05952649191021919,
            0.020197756588459015,
            0.03895943611860275,
            0.004077147226780653,
            0.026496144011616707,
            -0.02277253568172455,
            0.005767420865595341,
            -0.018845925107598305,
            0.034084320068359375,
            0.004399542696774006,
            0.0316573865711689,
            0.004155017901211977,
            -0.09351115673780441,
            0.06918929517269135,
            0.039492979645729065,
            0.009238188154995441,
            -0.07573536038398743,
            -0.01426721177995205,
            -0.009398194029927254,
            -0.036571163684129715,
            0.01612229086458683,
            -0.042382143437862396,
            -0.0068984548561275005,
            0.09683021157979965,
            -0.0187432412058115,
            0.11261739581823349,
            0.04001711308956146,
            -0.02951154112815857,
            0.030622316524386406,
            -0.012094789184629917,
            -0.01963229663670063,
            -0.04858902096748352,
            -0.01174047589302063,
            0.02892044372856617,
            -0.017641479149460793,
            -0.0437215194106102,
            0.02210555039346218,
            -0.0015220753848552704,
            0.020085811614990234,
            -0.004508133977651596,
            0.012043925933539867,
            -0.01804201304912567,
            -0.040649257600307465,
            -0.040280021727085114,
            0.020468570291996002,
            0.016827916726469994,
            -0.0507950522005558,
            0.010143174789845943,
            0.08644240349531174,
            0.07957837730646133,
            -0.05301407724618912,
            -0.024896997958421707,
            -0.05797343701124191,
            0.11501969397068024,
            0.029073162004351616,
            0.0051078530959784985,
            0.009118665009737015,
            -0.0912148728966713,
            0.014023243449628353,
            -0.029612815007567406,
            0.04628580063581467,
            0.07040295004844666,
            -0.07557704299688339,
            0.06818722188472748,
            -0.014259464107453823,
            -0.04523153230547905,
            0.07238060235977173,
            -0.009485247544944286,
            0.008597194217145443,
            0.09068455547094345,
            -0.05969524756073952,
            0.07476720958948135,
            0.030170630663633347,
            -0.057958755642175674,
            -0.03830433636903763,
            -0.016067931428551674,
            -0.04489272087812424,
            -0.012557834386825562,
            -0.08076123893260956,
            -0.03559476137161255,
            -0.054170262068510056,
            0.05495510995388031,
            0.03465660288929939,
            0.0637698844075203,
            -0.003932842519134283,
            0.04610856994986534,
            -0.10064198076725006,
            -0.006727264728397131,
            0.016383139416575432,
            -0.05118856951594353,
            -0.008541851304471493,
            0.1048741415143013,
            -0.033692244440317154,
            -0.015009834431111813,
            0.054833605885505676,
            -0.030323438346385956,
            -0.01922871731221676,
            -0.004449940752238035,
            0.0009935521520674229,
            -0.053164709359407425,
            0.013289177790284157,
            0.00800948403775692,
            0.025207241997122765,
            0.03203672543168068,
            0.0159728042781353,
            -0.0019451469415798783,
            -0.025858378037810326,
            0.003811911214143038,
            -0.0007070595165714622,
            -0.06838871538639069,
            -0.02424040250480175,
            -0.03514431044459343,
            0.10322929918766022,
            -0.059738293290138245,
            -0.016767270863056183,
            0.04758531600236893,
            0.0053009409457445145,
            0.01585463434457779,
            0.06050555035471916,
            -0.02351142279803753,
            0.028913114219903946,
            0.0409059152007103,
            -0.037876591086387634,
            -0.02660094015300274,
            -0.07878168672323227,
            -0.10875652730464935,
            0.041324812918901443,
            -0.03852027654647827,
            0.06697846949100494,
            -0.07236555963754654,
            -0.060778431594371796,
            -0.023312076926231384,
            0.13566181063652039,
            0.05942463129758835,
            0.042442016303539276,
            0.011608626693487167,
            0.013611102476716042,
            0.0467606820166111,
            0.010652383789420128,
            0.009909585118293762,
            -0.1229449212551117,
            -0.0774649977684021,
            -0.08852176368236542,
            -0.02603425830602646,
            0.015660369768738747,
            0.014925223775207996,
            -0.006933133117854595,
            0.09392380714416504,
            -0.11864395439624786,
            0.029810357838869095,
            0.008116704411804676,
            0.012341981753706932,
            -0.057908281683921814,
            0.024246595799922943,
            0.005292652174830437,
            -0.04638510197401047,
            0.03164558485150337,
            -0.01783127151429653,
            0.023113351315259933,
            -0.021473081782460213,
            -0.04495728015899658,
            -0.0489838570356369,
            0.021811185404658318,
            0.07806515693664551,
            0.002124704187735915,
            -0.05481017008423805,
            -0.04687852784991264,
            -0.02297184243798256,
            0.021443545818328857,
            0.03264031559228897,
            0.0003128442622255534,
            0.04523957893252373,
            -0.1271415501832962,
            0.0671202689409256,
            -0.07674111425876617,
            0.039126113057136536,
            0.12357396632432938,
            0.00819889921694994,
            0.028351806104183197,
            -0.008366379886865616,
            0.03786984086036682,
            -0.03940378129482269,
            0.004199545830488205,
            0.08905965089797974,
            0.02636674791574478,
            0.13493403792381287,
            0.060356754809617996,
            0.04773511365056038,
            0.008691680617630482,
            -0.036999255418777466,
            0.004985872656106949,
            0.03408161550760269,
            0.018793860450387,
            -0.01333162933588028,
            0.08478252589702606,
            -0.01684817485511303,
            0.09032021462917328,
            -0.0340888537466526,
            0.04709931090474129,
            -0.008690912276506424,
            -0.0495891347527504,
            -0.05930714309215546,
            0.01009418535977602,
            0.049603551626205444,
            0.08210539072751999,
            0.02808409370481968,
            0.034355293959379196,
            -0.018834136426448822,
            -0.09677813947200775,
            -0.03237484395503998,
            -0.03555070608854294,
            -0.06383436918258667,
            0.03483237326145172,
            0.01714547537267208,
            0.0035199634730815887,
            -0.06165474280714989,
            7.85944926914588e-33,
            0.028866415843367577,
            -0.04647941514849663,
            -0.05888395383954048,
            0.07047773897647858,
            0.055506832897663116,
            0.0028398940339684486,
            0.040329258888959885,
            -0.06423458456993103,
            -0.011908282525837421,
            0.05020765960216522,
            -0.04150787740945816,
            -0.030940746888518333,
            0.11088748276233673,
            -0.04858129099011421,
            -0.10024851560592651,
            0.028600899502635002,
            -0.0047572338953614235,
            -0.09413924813270569,
            0.021019449457526207,
            0.005526501685380936,
            0.010176003910601139,
            -0.026425836607813835,
            0.01222997810691595,
            0.022507471963763237,
            -0.0018880009884014726,
            -0.0022913094144314528,
            0.05878821387887001,
            -0.08903750777244568,
            -0.0864739865064621,
            -0.03905723989009857,
            -0.046932462602853775,
            -0.05436200648546219,
            0.020368197932839394,
            -0.026840437203645706,
            0.025138165801763535,
            -0.016524475067853928,
            0.036324936896562576,
            -0.0899248942732811,
            -0.023870108649134636,
            -0.02322075329720974,
            0.03881451115012169,
            0.06106534227728844,
            0.04234654828906059,
            -0.022839650511741638,
            0.05618314445018768,
            0.046128541231155396,
            -0.05084122344851494,
            0.08304987102746964,
            -0.033476121723651886,
            -0.015991127118468285,
            -0.07135190069675446,
            0.09570572525262833,
            -0.06097591295838356,
            -0.011919123120605946,
            0.010229592211544514,
            0.05714195594191551,
            -0.0894802063703537,
            0.06984465569257736,
            -0.11130580306053162,
            0.08219874650239944,
            -0.025544853881001472,
            0.0000017220658037331305,
            -0.03961511328816414,
            0.11663887649774551,
            0.00991143099963665,
            0.02549632638692856,
            0.02792959101498127,
            -0.0560375452041626,
            -0.1255187839269638,
            0.036713678389787674,
            0.05951154977083206,
            -0.07247511297464371,
            0.052210014313459396,
            -0.016808222979307175,
            0.002298749517649412,
            0.012870670296251774,
            0.028170030564069748,
            0.03624413534998894,
            0.00646212650462985,
            0.011977734975516796,
            0.03474821895360947,
            0.05897247791290283,
            -0.019231434911489487,
            -0.00565249053761363,
            -0.0016013863496482372,
            0.032272014766931534,
            -0.009905013255774975,
            0.07812612503767014,
            0.0063345469534397125,
            0.007176761049777269,
            -0.024810222908854485,
            -0.13774797320365906,
            -0.15348905324935913,
            -0.06804517656564713,
            0.0785336121916771,
            2.1150058597282992e-32,
            -0.013892804272472858,
            0.05591318756341934,
            0.050703782588243484,
            -0.016834644600749016,
            0.027637803927063942,
            -0.033562108874320984,
            0.05419256538152695,
            0.11449886858463287,
            0.029707586392760277,
            -0.022709520533680916,
            0.07389979809522629,
            -0.07357893884181976,
            -0.10579443722963333,
            -0.007560309953987598,
            0.004672566428780556,
            0.010546407662332058,
            -0.03701718524098396,
            0.02584259770810604,
            -0.020555920898914337,
            -0.029343249276280403,
            -0.008900263346731663,
            -0.006442338693886995,
            0.07320588082075119,
            -0.001093558152206242,
            0.060992028564214706,
            -0.008974148891866207,
            0.004197342786937952,
            -0.009920436888933182,
            -0.025736892595887184,
            -0.0724557638168335,
            -0.0020025083795189857,
            0.07366622239351273,
            0.040275849401950836,
            0.03316127508878708,
            -0.000025899140382534824,
            0.07468714565038681,
            0.03121902421116829,
            -0.009058235213160515,
            -0.03177209943532944,
            0.07971727848052979,
            0.040641337633132935,
            0.11953351646661758,
            -0.03250516951084137,
            -0.022773459553718567,
            -0.06430361419916153,
            0.06316282600164413,
            0.035190682858228683,
            -0.04853269085288048,
            0.0500844307243824,
            -0.04704730212688446,
            -0.02760794386267662,
            -0.049474384635686874,
            0.037018924951553345,
            0.008347260765731335,
            0.004771129228174686,
            0.00255514495074749,
            -0.000719240284524858,
            -0.10453514009714127,
            0.0712762326002121,
            0.002318795770406723,
            0.04635736718773842,
            -0.07783054560422897,
            0.035038504749536514,
            -0.05477318540215492,
        ],
    ),
    (
        False,
        "facebook/dpr-ctx_encoder-multiset-base",
        "Elasticsearch is the distributed, RESTful search and analytics engine at the heart of the Elastic Stack. "
        "You can use Elasticsearch to store, search, and manage data.",
        [
            -0.6601026058197021,
            -0.07532643526792526,
            0.402901291847229,
            0.21515817940235138,
            -0.12304636090993881,
            -0.46135443449020386,
            -0.4128194749355316,
            -0.04171863570809364,
            -0.16218756139278412,
            0.10256430506706238,
            -0.6015726327896118,
            0.2651500105857849,
            -0.21353624761104584,
            -0.08861052244901657,
            -0.12914299964904785,
            -0.09604646265506744,
            0.08802305161952972,
            0.3899032771587372,
            -0.10354535281658173,
            -0.48359155654907227,
            -0.038445957005023956,
            -0.5131939649581909,
            0.11561258137226105,
            -0.22291722893714905,
            0.2926093637943268,
            0.052824392914772034,
            0.47191688418388367,
            0.26812952756881714,
            -0.16708770394325256,
            0.3422102630138397,
            -0.40509673953056335,
            -0.08313518762588501,
            -0.29429352283477783,
            -0.17645713686943054,
            -0.15858185291290283,
            0.02803806960582733,
            -0.6775059103965759,
            0.13179722428321838,
            -0.18280582129955292,
            -0.5473679900169373,
            0.00934581458568573,
            0.27154743671417236,
            -0.3007986843585968,
            0.635735034942627,
            0.4057597815990448,
            -0.2014169991016388,
            -1.5299345254898071,
            -0.37508416175842285,
            -0.7460361123085022,
            0.0317460298538208,
            -0.8268659710884094,
            0.7399439215660095,
            -0.12918323278427124,
            0.031799640506505966,
            -0.037215691059827805,
            -0.6921950578689575,
            0.07970686256885529,
            -0.04082562029361725,
            0.37158381938934326,
            0.1483190804719925,
            -0.1926618069410324,
            0.1362791657447815,
            -0.11692776530981064,
            0.2002025842666626,
            0.23276634514331818,
            -0.04017801955342293,
            0.08747006207704544,
            0.15041899681091309,
            -0.4039083421230316,
            0.04110118746757507,
            0.4528273940086365,
            -0.15882685780525208,
            -0.39014527201652527,
            -0.05529152601957321,
            -0.009369902312755585,
            0.11566886305809021,
            0.004829317331314087,
            0.31739282608032227,
            0.1941411793231964,
            0.5709099769592285,
            -0.05342672020196915,
            0.5368376970291138,
            0.4321688413619995,
            0.0283671785145998,
            0.11711454391479492,
            -0.010006748139858246,
            -0.11122529208660126,
            0.5414866209030151,
            -0.3319847881793976,
            0.4014045000076294,
            -0.2751964032649994,
            -0.13060520589351654,
            0.23216612637043,
            0.4201193153858185,
            0.5293008089065552,
            0.0815778598189354,
            0.32006049156188965,
            0.12394090741872787,
            -0.17240574955940247,
            0.5535839796066284,
            -0.4775224030017853,
            0.36364659667015076,
            -0.3307642936706543,
            -0.5616685152053833,
            0.10873483121395111,
            -0.03524153307080269,
            -0.6815457344055176,
            -0.885098934173584,
            -0.2617311477661133,
            0.25207704305648804,
            -0.34165140986442566,
            0.4009418785572052,
            -0.40539348125457764,
            -0.15594974160194397,
            -0.2543904185295105,
            0.5649720430374146,
            0.04545155540108681,
            0.11830055713653564,
            0.08229959011077881,
            -0.027627382427453995,
            0.43120986223220825,
            0.8225383162498474,
            0.05617162585258484,
            0.1819731891155243,
            0.12549160420894623,
            0.05181269347667694,
            -0.054911088198423386,
            0.6784601211547852,
            0.09264181554317474,
            0.40221258997917175,
            0.23783773183822632,
            0.7137957811355591,
            0.11347964406013489,
            -0.1104956641793251,
            -0.061647504568099976,
            -0.3440624475479126,
            0.23476646840572357,
            0.3054472506046295,
            0.584572434425354,
            -0.2868909239768982,
            -0.10860852897167206,
            -0.0779828280210495,
            -0.18119598925113678,
            -0.569030225276947,
            0.16160205006599426,
            0.06319019943475723,
            -0.2809475362300873,
            0.051082924008369446,
            -0.12034206092357635,
            -0.25184494256973267,
            -0.26129356026649475,
            0.32261502742767334,
            -0.8822230100631714,
            -0.12353606522083282,
            -0.22996988892555237,
            0.5029481053352356,
            0.17791245877742767,
            -0.14227260649204254,
            -0.13449683785438538,
            0.30772310495376587,
            -0.3178018629550934,
            0.158952534198761,
            -0.08674933761358261,
            -0.2859618365764618,
            0.28637367486953735,
            -0.2635822892189026,
            0.18232391774654388,
            -0.073495052754879,
            0.040997982025146484,
            -0.013159672729671001,
            -0.4077923893928528,
            0.2565825879573822,
            -0.028333891183137894,
            0.30860811471939087,
            0.3730895519256592,
            -0.03221133351325989,
            0.6506873965263367,
            -0.10776633769273758,
            0.38631048798561096,
            0.2603285312652588,
            -0.5377027988433838,
            -0.15773208439350128,
            0.8508366346359253,
            -0.19234268367290497,
            0.4810645878314972,
            0.0825197771191597,
            0.4840788245201111,
            -0.04596978425979614,
            0.09320070594549179,
            0.05179097130894661,
            -0.4601348340511322,
            -0.3317601978778839,
            0.22374743223190308,
            -0.5843715071678162,
            0.2529716193675995,
            -0.30571508407592773,
            -0.673581063747406,
            0.7579544186592102,
            -0.05919931083917618,
            0.22153639793395996,
            0.0974859818816185,
            -0.10090627521276474,
            0.07847806066274643,
            -0.6562057137489319,
            -0.35805606842041016,
            -0.18164247274398804,
            -0.1364125907421112,
            0.05233104154467583,
            -0.4335939288139343,
            0.037998419255018234,
            0.12939786911010742,
            0.03151542693376541,
            0.13886386156082153,
            -0.48639899492263794,
            0.029982320964336395,
            -0.3249976634979248,
            -0.02190052717924118,
            -0.03787260502576828,
            0.3031986355781555,
            0.23743177950382233,
            1.3291674852371216,
            -0.4217178523540497,
            0.0706658735871315,
            0.15009371936321259,
            -0.22141501307487488,
            0.17221340537071228,
            0.5051579475402832,
            0.42485642433166504,
            1.0378373861312866,
            0.0038400590419769287,
            -0.13364961743354797,
            -0.21230444312095642,
            -0.21850202977657318,
            -0.4989981949329376,
            -0.2754150629043579,
            0.10592961311340332,
            -0.20453155040740967,
            0.005120525136590004,
            0.22218790650367737,
            0.17691189050674438,
            0.045828431844711304,
            0.20128732919692993,
            -0.38055020570755005,
            0.12259533256292343,
            0.21809561550617218,
            -0.462680846452713,
            0.09603960067033768,
            0.25817376375198364,
            -0.7398732304573059,
            -0.05785341188311577,
            0.051470763981342316,
            0.24638493359088898,
            -0.05622495710849762,
            -0.5236395001411438,
            -0.3112466037273407,
            0.06393332779407501,
            -0.3708273768424988,
            0.20614124834537506,
            -0.6160643100738525,
            1.2454907894134521,
            -0.07435797899961472,
            0.1489112824201584,
            -0.6544069051742554,
            0.29378825426101685,
            -0.06154976785182953,
            -0.37696516513824463,
            0.16466094553470612,
            -0.15475723147392273,
            0.24932968616485596,
            0.5101324319839478,
            0.4228943884372711,
            -0.28791654109954834,
            -0.03912848234176636,
            0.19124267995357513,
            -0.29454734921455383,
            -0.818303644657135,
            0.5248502492904663,
            0.13778886198997498,
            -0.6176903247833252,
            -0.4665703773498535,
            0.30064642429351807,
            0.6200433373451233,
            0.5600757598876953,
            0.10860106348991394,
            -0.41595885157585144,
            0.0529838502407074,
            0.2001836895942688,
            -0.20776328444480896,
            -0.7578458786010742,
            -0.2510881721973419,
            0.0760403648018837,
            0.04012983664870262,
            -0.03577745705842972,
            0.028626978397369385,
            0.20948448777198792,
            0.4007943272590637,
            0.038129404187202454,
            0.1735616773366928,
            -0.07657785713672638,
            0.0658252164721489,
            -0.7877234816551208,
            0.059954263269901276,
            0.5105605125427246,
            -0.5406082272529602,
            0.08662262558937073,
            0.12494724988937378,
            -0.21813702583312988,
            -0.22933034598827362,
            -6.106317043304443,
            -0.02108001708984375,
            -0.7386149168014526,
            -0.33728450536727905,
            -0.3068055808544159,
            0.024702906608581543,
            0.08534671366214752,
            -0.27438458800315857,
            -0.018134772777557373,
            0.2959413528442383,
            -0.523780882358551,
            -0.30268311500549316,
            -0.02081991732120514,
            0.2785957455635071,
            0.060176149010658264,
            0.008904479444026947,
            1.170113444328308,
            0.5542339086532593,
            0.122757688164711,
            0.17144793272018433,
            -0.15999354422092438,
            -0.33113154768943787,
            -0.1580493301153183,
            0.2569209635257721,
            -0.0695636048913002,
            -0.3847631812095642,
            -0.0652245432138443,
            0.49981093406677246,
            -0.26193320751190186,
            -0.3896259069442749,
            0.5998901724815369,
            -0.08010150492191315,
            -0.5056028366088867,
            -0.06169440969824791,
            -0.19861195981502533,
            -0.20143187046051025,
            -0.19022533297538757,
            0.42462438344955444,
            0.045151956379413605,
            -0.7065578103065491,
            0.4680316746234894,
            -0.12901535630226135,
            0.4474465847015381,
            -0.598564624786377,
            0.43031787872314453,
            -0.22827337682247162,
            -0.1445631980895996,
            0.08458518236875534,
            0.1768742799758911,
            0.5667708516120911,
            -0.00782996416091919,
            -0.2855917811393738,
            0.39840400218963623,
            -0.025000102818012238,
            -0.020751122385263443,
            -0.7555593848228455,
            0.3826548457145691,
            0.309017151594162,
            -0.05180130526423454,
            0.42092156410217285,
            0.3703360855579376,
            -0.5843119621276855,
            -0.24068240821361542,
            -0.9914456605911255,
            -0.6539044380187988,
            -0.19931605458259583,
            -0.6780067086219788,
            -0.1361950784921646,
            0.04267062619328499,
            0.43508970737457275,
            -0.8459522724151611,
            0.06912746280431747,
            -0.13955914974212646,
            -0.7766717672348022,
            0.569915771484375,
            -0.4256405532360077,
            -0.05063829571008682,
            -0.45155638456344604,
            -0.0389305055141449,
            -0.13221216201782227,
            -0.3269854187965393,
            -0.40613600611686707,
            -0.21334290504455566,
            0.051616448909044266,
            0.08559992909431458,
            0.10253014415502548,
            0.2922934293746948,
            0.1784224808216095,
            -0.39911535382270813,
            0.24486300349235535,
            0.430320143699646,
            -0.03885507956147194,
            0.1698797643184662,
            -0.079780712723732,
            0.4761188328266144,
            -0.19194892048835754,
            0.00938994437456131,
            0.01674146205186844,
            0.054788846522569656,
            -0.4920789301395416,
            0.3144996166229248,
            -0.11981859058141708,
            -0.10123608261346817,
            -0.1529507339000702,
            0.3330274224281311,
            0.23653167486190796,
            -0.03861071914434433,
            -0.24185141921043396,
            1.0683979988098145,
            0.3736417591571808,
            0.12811820209026337,
            0.3765108287334442,
            -0.18171437084674835,
            -0.2834130823612213,
            0.12264733016490936,
            0.16919481754302979,
            -0.4479713439941406,
            -0.14165078103542328,
            0.1140785962343216,
            -0.0553605780005455,
            -0.22674217820167542,
            0.14017359912395477,
            0.03630904108285904,
            0.1609329879283905,
            0.06442397087812424,
            -0.02900421991944313,
            0.4404158890247345,
            0.24093113839626312,
            0.09528736770153046,
            -0.19863969087600708,
            0.575541079044342,
            0.1492926925420761,
            -0.05657758563756943,
            0.39231497049331665,
            0.19304069876670837,
            -0.3911155164241791,
            0.31389254331588745,
            0.1978059858083725,
            0.43781718611717224,
            -0.7434608936309814,
            0.40026772022247314,
            0.30410683155059814,
            0.033812835812568665,
            -0.5613178610801697,
            0.5376416444778442,
            0.5211118459701538,
            -0.09744134545326233,
            0.3770570755004883,
            -0.33007028698921204,
            0.15102054178714752,
            0.13382907211780548,
            -0.3680247366428375,
            -0.4416946768760681,
            -0.20225326716899872,
            -0.17711979150772095,
            0.08408692479133606,
            0.19745640456676483,
            0.02262052893638611,
            0.600125789642334,
            -0.6611708998680115,
            -0.03180616348981857,
            -0.29257845878601074,
            -0.6881704330444336,
            -0.015099026262760162,
            0.13643231987953186,
            0.23806968331336975,
            -0.578571617603302,
            0.07673816382884979,
            -0.16418150067329407,
            0.1539163738489151,
            -0.029629096388816833,
            -0.03598960116505623,
            -0.5479248762130737,
            -0.2375001311302185,
            0.21873241662979126,
            -0.00940743088722229,
            0.5053333044052124,
            -0.0275399312376976,
            0.16969294846057892,
            0.3155972361564636,
            0.10111338645219803,
            -0.20641961693763733,
            -0.18723446130752563,
            0.1521853655576706,
            0.35702192783355713,
            -0.5661831498146057,
            -0.20405904948711395,
            0.5619502067565918,
            -0.506775975227356,
            -0.711455225944519,
            0.626246452331543,
            0.012257441878318787,
            -0.0194878987967968,
            0.1728505641222,
            0.38463294506073,
            -0.6393828988075256,
            0.2598608434200287,
            -0.08490090072154999,
            0.02492273785173893,
            -0.8527039885520935,
            0.013475822284817696,
            0.3874051570892334,
            -0.25916141271591187,
            0.7554638385772705,
            -0.20682917535305023,
            -0.4922080636024475,
            0.29251551628112793,
            -0.10666478425264359,
            -0.03903698921203613,
            -0.23917831480503082,
            -0.35162344574928284,
            -0.5548571348190308,
            -0.32372337579727173,
            -0.08735878020524979,
            0.40179240703582764,
            -0.04108772426843643,
            0.13194921612739563,
            -0.45560091733932495,
            -0.23374870419502258,
            -0.006907105445861816,
            -0.5344241261482239,
            -0.24032245576381683,
            0.12132386863231659,
            0.1799831986427307,
            -0.34936198592185974,
            0.5498173832893372,
            0.4542120099067688,
            0.05816923826932907,
            0.00788453221321106,
            -0.24488240480422974,
            0.3088642656803131,
            -0.04734193533658981,
            0.2046397179365158,
            0.04162340611219406,
            -0.021836068481206894,
            -0.16358336806297302,
            -0.2074509561061859,
            0.4162037968635559,
            0.08972516655921936,
            -0.43237900733947754,
            -0.7188698649406433,
            0.6635757088661194,
            -0.4313499927520752,
            -0.1529054343700409,
            -0.1290099322795868,
            0.07443584501743317,
            -0.1865161955356598,
            -0.01665331795811653,
            -1.0399339199066162,
            0.33111169934272766,
            0.1102089211344719,
            -0.644564688205719,
            -0.15566831827163696,
            -0.27352893352508545,
            0.8218070268630981,
            0.3128804862499237,
            -0.27464815974235535,
            -0.3979206681251526,
            -0.2785407304763794,
            -0.18442538380622864,
            0.5410442352294922,
            -0.1500082165002823,
            -0.1943707913160324,
            0.607040524482727,
            0.011585623025894165,
            0.34426695108413696,
            -0.12571074068546295,
            -0.6838558912277222,
            0.1464480459690094,
            -0.753390371799469,
            -0.3718322515487671,
            0.2890251874923706,
            -0.263771116733551,
            0.5072028040885925,
            0.07162309437990189,
            0.326756089925766,
            0.025984687730669975,
            -0.45028454065322876,
            -0.0072801560163497925,
            0.02414918690919876,
            -0.3571920394897461,
            -0.10037606954574585,
            0.16745981574058533,
            0.01914815790951252,
            0.3134342432022095,
            -0.24686899781227112,
            0.08431395143270493,
            0.4212206304073334,
            -0.22102874517440796,
            0.41327112913131714,
            -0.7061974406242371,
            0.7221808433532715,
            0.36959946155548096,
            -0.06302216649055481,
            0.03671116381883621,
            0.48683908581733704,
            0.18478697538375854,
            -0.5544215440750122,
            -0.6106008887290955,
            -0.09411554038524628,
            -0.044615812599658966,
            0.5070099830627441,
            0.552650511264801,
            -0.32762426137924194,
            0.4335191547870636,
            0.42620542645454407,
            -0.3855172395706177,
            0.3458879888057709,
            0.14125210046768188,
            0.01862463541328907,
            0.25522905588150024,
            0.39247000217437744,
            0.692121148109436,
            0.707982063293457,
            -0.6233642101287842,
            0.0850960835814476,
            -0.044485822319984436,
            0.47012001276016235,
            0.5253692865371704,
            -0.1168588399887085,
            -0.18955998122692108,
            -0.24645841121673584,
            0.1549580991268158,
            -0.39623773097991943,
            -0.2750386595726013,
            0.9884428381919861,
            -0.3114641308784485,
            0.21831002831459045,
            -0.07272855192422867,
            0.48298054933547974,
            0.16971668601036072,
            0.031139254570007324,
            -0.21155042946338654,
            -0.037103280425071716,
            -0.36315596103668213,
            -0.4137076735496521,
            0.3359948396682739,
            0.24422727525234222,
            -0.16889692842960358,
            -0.20823507010936737,
            0.5200672149658203,
            -0.03240960091352463,
            0.0855783000588417,
            0.23546519875526428,
            -0.22527170181274414,
            0.1139104887843132,
            -0.1755366176366806,
            0.6013832688331604,
            0.0007665976881980896,
            0.4208429753780365,
            -0.10507550835609436,
            0.0957176461815834,
            0.30994364619255066,
            -0.3417087197303772,
            -0.188252255320549,
            -0.43263840675354004,
            0.47162070870399475,
            0.29631394147872925,
            -0.17578598856925964,
            0.6220195293426514,
            -0.07323019206523895,
            0.6022749543190002,
            0.14794260263442993,
            -0.21613992750644684,
            -0.10941394418478012,
            -0.22077707946300507,
            0.7468065619468689,
            0.3151116371154785,
            0.15509240329265594,
            0.568230152130127,
            -0.33526429533958435,
            0.2895146906375885,
            -0.069722019135952,
            0.13789677619934082,
            0.2286820113658905,
            -0.23858243227005005,
            0.10334969311952591,
            0.1952935755252838,
            0.2127007097005844,
            0.5021618008613586,
            0.45255613327026367,
            0.37878790497779846,
            -0.026557739824056625,
            -0.2529148757457733,
            0.2549300193786621,
            -0.019824489951133728,
            0.1643994301557541,
            0.26221510767936707,
            0.3206685185432434,
            -0.35314929485321045,
            -0.12910199165344238,
            -0.10526111721992493,
            0.15261510014533997,
            0.0745638832449913,
            0.24670161306858063,
            -0.11891080439090729,
            0.27865171432495117,
            0.7252128720283508,
            0.715528130531311,
            -0.058991920202970505,
            0.08567754179239273,
            0.1936284601688385,
            -0.43705376982688904,
            0.30046898126602173,
            -0.09120704978704453,
            0.3908286690711975,
            0.005695773288607597,
            -0.07798434793949127,
            -0.33310723304748535,
            0.24932220578193665,
            0.29148373007774353,
            0.2244613766670227,
            -0.12817345559597015,
            0.19253209233283997,
            -0.3593190908432007,
            0.024914085865020752,
            0.3590511679649353,
            -0.13121527433395386,
            -0.40432965755462646,
            -0.1270216703414917,
            -0.4150570333003998,
            -0.2667885720729828,
            0.33466431498527527,
            -0.20159241557121277,
            0.4322197437286377,
            -0.007005602121353149,
            -0.15468011796474457,
            0.2599427103996277,
            -0.47928857803344727,
            0.20738369226455688,
            -0.13063210248947144,
            -0.6041979193687439,
            -0.11467638611793518,
            1.0721454620361328,
            -0.4319901466369629,
            0.37762632966041565,
            -0.3697531521320343,
            -0.11898999661207199,
            0.19567334651947021,
            -0.45405951142311096,
            -0.5254712104797363,
            -0.13809697329998016,
            -0.6019450426101685,
            0.24826166033744812,
            -0.30094051361083984,
            0.5005353689193726,
            -0.5445337891578674,
            0.13059265911579132,
            -0.5595307350158691,
            0.4054068326950073,
            0.1642637550830841,
            -0.061807673424482346,
            -0.06119924038648605,
            -0.26129624247550964,
            -0.5019827485084534,
            0.4217642843723297,
            -0.08182455599308014,
            -0.269663006067276,
            -0.38531243801116943,
            -0.3106101453304291,
        ],
    ),
    (
        True,
        "facebook/dpr-ctx_encoder-multiset-base",
        "Elasticsearch is the distributed, RESTful search and analytics engine at the heart of the Elastic Stack. "
        "You can use Elasticsearch to store, search, and manage data.",
        [
            -0.6601026058197021,
            -0.07532643526792526,
            0.402901291847229,
            0.21515817940235138,
            -0.12304636090993881,
            -0.46135443449020386,
            -0.4128194749355316,
            -0.04171863570809364,
            -0.16218756139278412,
            0.10256430506706238,
            -0.6015726327896118,
            0.2651500105857849,
            -0.21353624761104584,
            -0.08861052244901657,
            -0.12914299964904785,
            -0.09604646265506744,
            0.08802305161952972,
            0.3899032771587372,
            -0.10354535281658173,
            -0.48359155654907227,
            -0.038445957005023956,
            -0.5131939649581909,
            0.11561258137226105,
            -0.22291722893714905,
            0.2926093637943268,
            0.052824392914772034,
            0.47191688418388367,
            0.26812952756881714,
            -0.16708770394325256,
            0.3422102630138397,
            -0.40509673953056335,
            -0.08313518762588501,
            -0.29429352283477783,
            -0.17645713686943054,
            -0.15858185291290283,
            0.02803806960582733,
            -0.6775059103965759,
            0.13179722428321838,
            -0.18280582129955292,
            -0.5473679900169373,
            0.00934581458568573,
            0.27154743671417236,
            -0.3007986843585968,
            0.635735034942627,
            0.4057597815990448,
            -0.2014169991016388,
            -1.5299345254898071,
            -0.37508416175842285,
            -0.7460361123085022,
            0.0317460298538208,
            -0.8268659710884094,
            0.7399439215660095,
            -0.12918323278427124,
            0.031799640506505966,
            -0.037215691059827805,
            -0.6921950578689575,
            0.07970686256885529,
            -0.04082562029361725,
            0.37158381938934326,
            0.1483190804719925,
            -0.1926618069410324,
            0.1362791657447815,
            -0.11692776530981064,
            0.2002025842666626,
            0.23276634514331818,
            -0.04017801955342293,
            0.08747006207704544,
            0.15041899681091309,
            -0.4039083421230316,
            0.04110118746757507,
            0.4528273940086365,
            -0.15882685780525208,
            -0.39014527201652527,
            -0.05529152601957321,
            -0.009369902312755585,
            0.11566886305809021,
            0.004829317331314087,
            0.31739282608032227,
            0.1941411793231964,
            0.5709099769592285,
            -0.05342672020196915,
            0.5368376970291138,
            0.4321688413619995,
            0.0283671785145998,
            0.11711454391479492,
            -0.010006748139858246,
            -0.11122529208660126,
            0.5414866209030151,
            -0.3319847881793976,
            0.4014045000076294,
            -0.2751964032649994,
            -0.13060520589351654,
            0.23216612637043,
            0.4201193153858185,
            0.5293008089065552,
            0.0815778598189354,
            0.32006049156188965,
            0.12394090741872787,
            -0.17240574955940247,
            0.5535839796066284,
            -0.4775224030017853,
            0.36364659667015076,
            -0.3307642936706543,
            -0.5616685152053833,
            0.10873483121395111,
            -0.03524153307080269,
            -0.6815457344055176,
            -0.885098934173584,
            -0.2617311477661133,
            0.25207704305648804,
            -0.34165140986442566,
            0.4009418785572052,
            -0.40539348125457764,
            -0.15594974160194397,
            -0.2543904185295105,
            0.5649720430374146,
            0.04545155540108681,
            0.11830055713653564,
            0.08229959011077881,
            -0.027627382427453995,
            0.43120986223220825,
            0.8225383162498474,
            0.05617162585258484,
            0.1819731891155243,
            0.12549160420894623,
            0.05181269347667694,
            -0.054911088198423386,
            0.6784601211547852,
            0.09264181554317474,
            0.40221258997917175,
            0.23783773183822632,
            0.7137957811355591,
            0.11347964406013489,
            -0.1104956641793251,
            -0.061647504568099976,
            -0.3440624475479126,
            0.23476646840572357,
            0.3054472506046295,
            0.584572434425354,
            -0.2868909239768982,
            -0.10860852897167206,
            -0.0779828280210495,
            -0.18119598925113678,
            -0.569030225276947,
            0.16160205006599426,
            0.06319019943475723,
            -0.2809475362300873,
            0.051082924008369446,
            -0.12034206092357635,
            -0.25184494256973267,
            -0.26129356026649475,
            0.32261502742767334,
            -0.8822230100631714,
            -0.12353606522083282,
            -0.22996988892555237,
            0.5029481053352356,
            0.17791245877742767,
            -0.14227260649204254,
            -0.13449683785438538,
            0.30772310495376587,
            -0.3178018629550934,
            0.158952534198761,
            -0.08674933761358261,
            -0.2859618365764618,
            0.28637367486953735,
            -0.2635822892189026,
            0.18232391774654388,
            -0.073495052754879,
            0.040997982025146484,
            -0.013159672729671001,
            -0.4077923893928528,
            0.2565825879573822,
            -0.028333891183137894,
            0.30860811471939087,
            0.3730895519256592,
            -0.03221133351325989,
            0.6506873965263367,
            -0.10776633769273758,
            0.38631048798561096,
            0.2603285312652588,
            -0.5377027988433838,
            -0.15773208439350128,
            0.8508366346359253,
            -0.19234268367290497,
            0.4810645878314972,
            0.0825197771191597,
            0.4840788245201111,
            -0.04596978425979614,
            0.09320070594549179,
            0.05179097130894661,
            -0.4601348340511322,
            -0.3317601978778839,
            0.22374743223190308,
            -0.5843715071678162,
            0.2529716193675995,
            -0.30571508407592773,
            -0.673581063747406,
            0.7579544186592102,
            -0.05919931083917618,
            0.22153639793395996,
            0.0974859818816185,
            -0.10090627521276474,
            0.07847806066274643,
            -0.6562057137489319,
            -0.35805606842041016,
            -0.18164247274398804,
            -0.1364125907421112,
            0.05233104154467583,
            -0.4335939288139343,
            0.037998419255018234,
            0.12939786911010742,
            0.03151542693376541,
            0.13886386156082153,
            -0.48639899492263794,
            0.029982320964336395,
            -0.3249976634979248,
            -0.02190052717924118,
            -0.03787260502576828,
            0.3031986355781555,
            0.23743177950382233,
            1.3291674852371216,
            -0.4217178523540497,
            0.0706658735871315,
            0.15009371936321259,
            -0.22141501307487488,
            0.17221340537071228,
            0.5051579475402832,
            0.42485642433166504,
            1.0378373861312866,
            0.0038400590419769287,
            -0.13364961743354797,
            -0.21230444312095642,
            -0.21850202977657318,
            -0.4989981949329376,
            -0.2754150629043579,
            0.10592961311340332,
            -0.20453155040740967,
            0.005120525136590004,
            0.22218790650367737,
            0.17691189050674438,
            0.045828431844711304,
            0.20128732919692993,
            -0.38055020570755005,
            0.12259533256292343,
            0.21809561550617218,
            -0.462680846452713,
            0.09603960067033768,
            0.25817376375198364,
            -0.7398732304573059,
            -0.05785341188311577,
            0.051470763981342316,
            0.24638493359088898,
            -0.05622495710849762,
            -0.5236395001411438,
            -0.3112466037273407,
            0.06393332779407501,
            -0.3708273768424988,
            0.20614124834537506,
            -0.6160643100738525,
            1.2454907894134521,
            -0.07435797899961472,
            0.1489112824201584,
            -0.6544069051742554,
            0.29378825426101685,
            -0.06154976785182953,
            -0.37696516513824463,
            0.16466094553470612,
            -0.15475723147392273,
            0.24932968616485596,
            0.5101324319839478,
            0.4228943884372711,
            -0.28791654109954834,
            -0.03912848234176636,
            0.19124267995357513,
            -0.29454734921455383,
            -0.818303644657135,
            0.5248502492904663,
            0.13778886198997498,
            -0.6176903247833252,
            -0.4665703773498535,
            0.30064642429351807,
            0.6200433373451233,
            0.5600757598876953,
            0.10860106348991394,
            -0.41595885157585144,
            0.0529838502407074,
            0.2001836895942688,
            -0.20776328444480896,
            -0.7578458786010742,
            -0.2510881721973419,
            0.0760403648018837,
            0.04012983664870262,
            -0.03577745705842972,
            0.028626978397369385,
            0.20948448777198792,
            0.4007943272590637,
            0.038129404187202454,
            0.1735616773366928,
            -0.07657785713672638,
            0.0658252164721489,
            -0.7877234816551208,
            0.059954263269901276,
            0.5105605125427246,
            -0.5406082272529602,
            0.08662262558937073,
            0.12494724988937378,
            -0.21813702583312988,
            -0.22933034598827362,
            -6.106317043304443,
            -0.02108001708984375,
            -0.7386149168014526,
            -0.33728450536727905,
            -0.3068055808544159,
            0.024702906608581543,
            0.08534671366214752,
            -0.27438458800315857,
            -0.018134772777557373,
            0.2959413528442383,
            -0.523780882358551,
            -0.30268311500549316,
            -0.02081991732120514,
            0.2785957455635071,
            0.060176149010658264,
            0.008904479444026947,
            1.170113444328308,
            0.5542339086532593,
            0.122757688164711,
            0.17144793272018433,
            -0.15999354422092438,
            -0.33113154768943787,
            -0.1580493301153183,
            0.2569209635257721,
            -0.0695636048913002,
            -0.3847631812095642,
            -0.0652245432138443,
            0.49981093406677246,
            -0.26193320751190186,
            -0.3896259069442749,
            0.5998901724815369,
            -0.08010150492191315,
            -0.5056028366088867,
            -0.06169440969824791,
            -0.19861195981502533,
            -0.20143187046051025,
            -0.19022533297538757,
            0.42462438344955444,
            0.045151956379413605,
            -0.7065578103065491,
            0.4680316746234894,
            -0.12901535630226135,
            0.4474465847015381,
            -0.598564624786377,
            0.43031787872314453,
            -0.22827337682247162,
            -0.1445631980895996,
            0.08458518236875534,
            0.1768742799758911,
            0.5667708516120911,
            -0.00782996416091919,
            -0.2855917811393738,
            0.39840400218963623,
            -0.025000102818012238,
            -0.020751122385263443,
            -0.7555593848228455,
            0.3826548457145691,
            0.309017151594162,
            -0.05180130526423454,
            0.42092156410217285,
            0.3703360855579376,
            -0.5843119621276855,
            -0.24068240821361542,
            -0.9914456605911255,
            -0.6539044380187988,
            -0.19931605458259583,
            -0.6780067086219788,
            -0.1361950784921646,
            0.04267062619328499,
            0.43508970737457275,
            -0.8459522724151611,
            0.06912746280431747,
            -0.13955914974212646,
            -0.7766717672348022,
            0.569915771484375,
            -0.4256405532360077,
            -0.05063829571008682,
            -0.45155638456344604,
            -0.0389305055141449,
            -0.13221216201782227,
            -0.3269854187965393,
            -0.40613600611686707,
            -0.21334290504455566,
            0.051616448909044266,
            0.08559992909431458,
            0.10253014415502548,
            0.2922934293746948,
            0.1784224808216095,
            -0.39911535382270813,
            0.24486300349235535,
            0.430320143699646,
            -0.03885507956147194,
            0.1698797643184662,
            -0.079780712723732,
            0.4761188328266144,
            -0.19194892048835754,
            0.00938994437456131,
            0.01674146205186844,
            0.054788846522569656,
            -0.4920789301395416,
            0.3144996166229248,
            -0.11981859058141708,
            -0.10123608261346817,
            -0.1529507339000702,
            0.3330274224281311,
            0.23653167486190796,
            -0.03861071914434433,
            -0.24185141921043396,
            1.0683979988098145,
            0.3736417591571808,
            0.12811820209026337,
            0.3765108287334442,
            -0.18171437084674835,
            -0.2834130823612213,
            0.12264733016490936,
            0.16919481754302979,
            -0.4479713439941406,
            -0.14165078103542328,
            0.1140785962343216,
            -0.0553605780005455,
            -0.22674217820167542,
            0.14017359912395477,
            0.03630904108285904,
            0.1609329879283905,
            0.06442397087812424,
            -0.02900421991944313,
            0.4404158890247345,
            0.24093113839626312,
            0.09528736770153046,
            -0.19863969087600708,
            0.575541079044342,
            0.1492926925420761,
            -0.05657758563756943,
            0.39231497049331665,
            0.19304069876670837,
            -0.3911155164241791,
            0.31389254331588745,
            0.1978059858083725,
            0.43781718611717224,
            -0.7434608936309814,
            0.40026772022247314,
            0.30410683155059814,
            0.033812835812568665,
            -0.5613178610801697,
            0.5376416444778442,
            0.5211118459701538,
            -0.09744134545326233,
            0.3770570755004883,
            -0.33007028698921204,
            0.15102054178714752,
            0.13382907211780548,
            -0.3680247366428375,
            -0.4416946768760681,
            -0.20225326716899872,
            -0.17711979150772095,
            0.08408692479133606,
            0.19745640456676483,
            0.02262052893638611,
            0.600125789642334,
            -0.6611708998680115,
            -0.03180616348981857,
            -0.29257845878601074,
            -0.6881704330444336,
            -0.015099026262760162,
            0.13643231987953186,
            0.23806968331336975,
            -0.578571617603302,
            0.07673816382884979,
            -0.16418150067329407,
            0.1539163738489151,
            -0.029629096388816833,
            -0.03598960116505623,
            -0.5479248762130737,
            -0.2375001311302185,
            0.21873241662979126,
            -0.00940743088722229,
            0.5053333044052124,
            -0.0275399312376976,
            0.16969294846057892,
            0.3155972361564636,
            0.10111338645219803,
            -0.20641961693763733,
            -0.18723446130752563,
            0.1521853655576706,
            0.35702192783355713,
            -0.5661831498146057,
            -0.20405904948711395,
            0.5619502067565918,
            -0.506775975227356,
            -0.711455225944519,
            0.626246452331543,
            0.012257441878318787,
            -0.0194878987967968,
            0.1728505641222,
            0.38463294506073,
            -0.6393828988075256,
            0.2598608434200287,
            -0.08490090072154999,
            0.02492273785173893,
            -0.8527039885520935,
            0.013475822284817696,
            0.3874051570892334,
            -0.25916141271591187,
            0.7554638385772705,
            -0.20682917535305023,
            -0.4922080636024475,
            0.29251551628112793,
            -0.10666478425264359,
            -0.03903698921203613,
            -0.23917831480503082,
            -0.35162344574928284,
            -0.5548571348190308,
            -0.32372337579727173,
            -0.08735878020524979,
            0.40179240703582764,
            -0.04108772426843643,
            0.13194921612739563,
            -0.45560091733932495,
            -0.23374870419502258,
            -0.006907105445861816,
            -0.5344241261482239,
            -0.24032245576381683,
            0.12132386863231659,
            0.1799831986427307,
            -0.34936198592185974,
            0.5498173832893372,
            0.4542120099067688,
            0.05816923826932907,
            0.00788453221321106,
            -0.24488240480422974,
            0.3088642656803131,
            -0.04734193533658981,
            0.2046397179365158,
            0.04162340611219406,
            -0.021836068481206894,
            -0.16358336806297302,
            -0.2074509561061859,
            0.4162037968635559,
            0.08972516655921936,
            -0.43237900733947754,
            -0.7188698649406433,
            0.6635757088661194,
            -0.4313499927520752,
            -0.1529054343700409,
            -0.1290099322795868,
            0.07443584501743317,
            -0.1865161955356598,
            -0.01665331795811653,
            -1.0399339199066162,
            0.33111169934272766,
            0.1102089211344719,
            -0.644564688205719,
            -0.15566831827163696,
            -0.27352893352508545,
            0.8218070268630981,
            0.3128804862499237,
            -0.27464815974235535,
            -0.3979206681251526,
            -0.2785407304763794,
            -0.18442538380622864,
            0.5410442352294922,
            -0.1500082165002823,
            -0.1943707913160324,
            0.607040524482727,
            0.011585623025894165,
            0.34426695108413696,
            -0.12571074068546295,
            -0.6838558912277222,
            0.1464480459690094,
            -0.753390371799469,
            -0.3718322515487671,
            0.2890251874923706,
            -0.263771116733551,
            0.5072028040885925,
            0.07162309437990189,
            0.326756089925766,
            0.025984687730669975,
            -0.45028454065322876,
            -0.0072801560163497925,
            0.02414918690919876,
            -0.3571920394897461,
            -0.10037606954574585,
            0.16745981574058533,
            0.01914815790951252,
            0.3134342432022095,
            -0.24686899781227112,
            0.08431395143270493,
            0.4212206304073334,
            -0.22102874517440796,
            0.41327112913131714,
            -0.7061974406242371,
            0.7221808433532715,
            0.36959946155548096,
            -0.06302216649055481,
            0.03671116381883621,
            0.48683908581733704,
            0.18478697538375854,
            -0.5544215440750122,
            -0.6106008887290955,
            -0.09411554038524628,
            -0.044615812599658966,
            0.5070099830627441,
            0.552650511264801,
            -0.32762426137924194,
            0.4335191547870636,
            0.42620542645454407,
            -0.3855172395706177,
            0.3458879888057709,
            0.14125210046768188,
            0.01862463541328907,
            0.25522905588150024,
            0.39247000217437744,
            0.692121148109436,
            0.707982063293457,
            -0.6233642101287842,
            0.0850960835814476,
            -0.044485822319984436,
            0.47012001276016235,
            0.5253692865371704,
            -0.1168588399887085,
            -0.18955998122692108,
            -0.24645841121673584,
            0.1549580991268158,
            -0.39623773097991943,
            -0.2750386595726013,
            0.9884428381919861,
            -0.3114641308784485,
            0.21831002831459045,
            -0.07272855192422867,
            0.48298054933547974,
            0.16971668601036072,
            0.031139254570007324,
            -0.21155042946338654,
            -0.037103280425071716,
            -0.36315596103668213,
            -0.4137076735496521,
            0.3359948396682739,
            0.24422727525234222,
            -0.16889692842960358,
            -0.20823507010936737,
            0.5200672149658203,
            -0.03240960091352463,
            0.0855783000588417,
            0.23546519875526428,
            -0.22527170181274414,
            0.1139104887843132,
            -0.1755366176366806,
            0.6013832688331604,
            0.0007665976881980896,
            0.4208429753780365,
            -0.10507550835609436,
            0.0957176461815834,
            0.30994364619255066,
            -0.3417087197303772,
            -0.188252255320549,
            -0.43263840675354004,
            0.47162070870399475,
            0.29631394147872925,
            -0.17578598856925964,
            0.6220195293426514,
            -0.07323019206523895,
            0.6022749543190002,
            0.14794260263442993,
            -0.21613992750644684,
            -0.10941394418478012,
            -0.22077707946300507,
            0.7468065619468689,
            0.3151116371154785,
            0.15509240329265594,
            0.568230152130127,
            -0.33526429533958435,
            0.2895146906375885,
            -0.069722019135952,
            0.13789677619934082,
            0.2286820113658905,
            -0.23858243227005005,
            0.10334969311952591,
            0.1952935755252838,
            0.2127007097005844,
            0.5021618008613586,
            0.45255613327026367,
            0.37878790497779846,
            -0.026557739824056625,
            -0.2529148757457733,
            0.2549300193786621,
            -0.019824489951133728,
            0.1643994301557541,
            0.26221510767936707,
            0.3206685185432434,
            -0.35314929485321045,
            -0.12910199165344238,
            -0.10526111721992493,
            0.15261510014533997,
            0.0745638832449913,
            0.24670161306858063,
            -0.11891080439090729,
            0.27865171432495117,
            0.7252128720283508,
            0.715528130531311,
            -0.058991920202970505,
            0.08567754179239273,
            0.1936284601688385,
            -0.43705376982688904,
            0.30046898126602173,
            -0.09120704978704453,
            0.3908286690711975,
            0.005695773288607597,
            -0.07798434793949127,
            -0.33310723304748535,
            0.24932220578193665,
            0.29148373007774353,
            0.2244613766670227,
            -0.12817345559597015,
            0.19253209233283997,
            -0.3593190908432007,
            0.024914085865020752,
            0.3590511679649353,
            -0.13121527433395386,
            -0.40432965755462646,
            -0.1270216703414917,
            -0.4150570333003998,
            -0.2667885720729828,
            0.33466431498527527,
            -0.20159241557121277,
            0.4322197437286377,
            -0.007005602121353149,
            -0.15468011796474457,
            0.2599427103996277,
            -0.47928857803344727,
            0.20738369226455688,
            -0.13063210248947144,
            -0.6041979193687439,
            -0.11467638611793518,
            1.0721454620361328,
            -0.4319901466369629,
            0.37762632966041565,
            -0.3697531521320343,
            -0.11898999661207199,
            0.19567334651947021,
            -0.45405951142311096,
            -0.5254712104797363,
            -0.13809697329998016,
            -0.6019450426101685,
            0.24826166033744812,
            -0.30094051361083984,
            0.5005353689193726,
            -0.5445337891578674,
            0.13059265911579132,
            -0.5595307350158691,
            0.4054068326950073,
            0.1642637550830841,
            -0.061807673424482346,
            -0.06119924038648605,
            -0.26129624247550964,
            -0.5019827485084534,
            0.4217642843723297,
            -0.08182455599308014,
            -0.269663006067276,
            -0.38531243801116943,
            -0.3106101453304291,
        ],
    ),
]


@pytest.fixture(scope="function", autouse=True)
def setup_and_tear_down():
    ES_TEST_CLIENT.cluster.put_settings(
        body={"transient": {"logger.org.elasticsearch.xpack.ml": "DEBUG"}}
    )
    yield
    for model_id, _, _, _ in TEXT_PREDICTION_MODELS:
        model = PyTorchModel(ES_TEST_CLIENT, model_id.replace("/", "__").lower()[:64])
        model.stop()
        model.delete()

    for _, model_id, _, _ in TEXT_EMBEDDING:
        model = PyTorchModel(ES_TEST_CLIENT, model_id.replace("/", "__").lower()[:64])
        model.stop()
        model.delete()

    for model_id, _, _, _ in ZERO_SHOT_MODELS:
        model = PyTorchModel(ES_TEST_CLIENT, model_id.replace("/", "__").lower()[:64])
        model.stop()
        model.delete()


def download_model_and_start_deployment(tmp_dir, quantize, model_id, task):
    print("Loading HuggingFace transformer tokenizer and model")
    tm = TransformerModel(model_id, task, quantize)
    model_path, config_path, vocab_path = tm.save(tmp_dir)
    ptm = PyTorchModel(ES_TEST_CLIENT, tm.elasticsearch_model_id())
    ptm.stop()
    ptm.delete()
    print(f"Importing model: {ptm.model_id}")
    ptm.import_model(model_path, config_path, vocab_path)
    ptm.start()
    return ptm


class TestPytorchModel:
    @pytest.mark.parametrize("quantize", [True, False])
    @pytest.mark.parametrize("model_id,task,text_input,value", TEXT_PREDICTION_MODELS)
    def test_text_classification(self, quantize, model_id, task, text_input, value):
        with tempfile.TemporaryDirectory() as tmp_dir:
            ptm = download_model_and_start_deployment(tmp_dir, quantize, model_id, task)
            result = ptm.infer({"docs": [{"text_field": text_input}]})
            assert result["predicted_value"] == value

    @pytest.mark.parametrize("quantize", [True, False])
    @pytest.mark.parametrize("model_id,text_input,labels,value", ZERO_SHOT_MODELS)
    @pytest.mark.skip("temp skip")
    def test_zero_shot_classification(
        self, quantize, model_id, text_input, labels, value
    ):
        with tempfile.TemporaryDirectory() as tmp_dir:
            ptm = download_model_and_start_deployment(
                tmp_dir, quantize, model_id, "zero_shot_classification"
            )
            result = ptm.infer(
                {
                    "docs": [{"text_field": text_input}],
                    "inference_config": {
                        "zero_shot_classification": {"labels": labels}
                    },
                }
            )
            assert result["predicted_value"] == value

    @pytest.mark.parametrize("quantize,model_id,text_input,value", TEXT_EMBEDDING)
    @pytest.mark.skip("temp skip")
    def test_text_embedding(self, quantize, model_id, text_input, value):
        with tempfile.TemporaryDirectory() as tmp_dir:
            ptm = download_model_and_start_deployment(
                tmp_dir, quantize, model_id, "text_embedding"
            )
            result = ptm.infer({"docs": [{"text_field": text_input}]})
            np.testing.assert_almost_equal(result["predicted_value"], value, decimal=2)
